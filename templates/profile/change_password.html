{% extends "base.html" %}

{% block title %}Change Password - Skileez{% endblock %}

{% block content %}
<div class="min-h-screen bg-gradient-to-br from-blue-50 via-white to-indigo-50 py-8">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
        <!-- Header -->
        <div class="text-center mb-8">
            <div class="inline-flex items-center justify-center w-16 h-16 bg-gradient-to-r from-blue-600 to-indigo-600 rounded-2xl shadow-lg mb-4">
                <i data-feather="shield" class="w-8 h-8 text-white"></i>
            </div>
            <h1 class="text-3xl font-bold text-gray-900 mb-2">Change Your Password</h1>
            <p class="text-gray-600">Keep your account secure with a strong password</p>
        </div>

        <!-- Main Content -->
        <div class="bg-white rounded-2xl shadow-xl border border-gray-200 overflow-hidden">
            <!-- Header Section -->
            <div class="bg-gradient-to-r from-blue-600 to-indigo-600 px-6 py-4">
                <h2 class="text-xl font-bold text-white flex items-center">
                    <i data-feather="lock" class="w-5 h-5 mr-3"></i>
                    Security Settings
                </h2>
            </div>

            <div class="p-8">
                <!-- Security Information -->
                <div class="mb-8 p-6 bg-blue-50 border border-blue-200 rounded-xl">
                    <div class="flex items-start space-x-4">
                        <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center flex-shrink-0">
                            <i data-feather="info" class="w-5 h-5 text-blue-600"></i>
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold text-blue-900 mb-2">Password Security</h3>
                            <p class="text-blue-800 mb-3">Your password is the key to your account. Make sure it's strong and unique to keep your information safe.</p>
                            <ul class="text-sm text-blue-700 space-y-1">
                                <li>• Use at least 8 characters with a mix of letters, numbers, and symbols</li>
                                <li>• Avoid using personal information like your name or birthdate</li>
                                <li>• Don't reuse passwords from other accounts</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Password Change Form -->
                <form method="POST" class="space-y-6" id="password-change-form">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>

                    <!-- Current Password -->
                    <div class="space-y-2">
                        <label for="current_password" class="block text-sm font-semibold text-gray-700">
                            Current Password
                            <span class="text-red-500">*</span>
                        </label>
                        <div class="relative">
                            <input type="password" 
                                   id="current_password" 
                                   name="current_password" 
                                   required
                                   class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 bg-gray-50 hover:bg-white"
                                   placeholder="Enter your current password">
                            <div class="absolute inset-y-0 right-0 pr-3 flex items-center">
                                <button type="button" 
                                        class="text-gray-400 hover:text-gray-600 focus:outline-none"
                                        onclick="togglePasswordVisibility('current_password')">
                                    <i data-feather="eye" class="w-5 h-5"></i>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- New Password -->
                    <div class="space-y-2">
                        <label for="new_password" class="block text-sm font-semibold text-gray-700">
                            New Password
                            <span class="text-red-500">*</span>
                        </label>
                        <div class="relative">
                            <input type="password" 
                                   id="new_password" 
                                   name="new_password" 
                                   required
                                   class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 bg-gray-50 hover:bg-white"
                                   placeholder="Enter your new password"
                                   oninput="validatePasswordStrength(this.value)">
                            <div class="absolute inset-y-0 right-0 pr-3 flex items-center">
                                <button type="button" 
                                        class="text-gray-400 hover:text-gray-600 focus:outline-none"
                                        onclick="togglePasswordVisibility('new_password')">
                                    <i data-feather="eye" class="w-5 h-5"></i>
                                </button>
                            </div>
                        </div>
                        
                        <!-- Password Strength Indicator -->
                        <div class="mt-4">
                            <div class="flex items-center justify-between mb-2">
                                <span class="text-sm font-medium text-gray-700">Password Strength:</span>
                                <span id="strength-text" class="text-sm font-medium text-gray-500">Weak</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                <div id="strength-bar" class="bg-red-500 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                            </div>
                        </div>

                        <!-- Password Requirements -->
                        <div class="mt-4 p-4 bg-gray-50 border border-gray-200 rounded-xl">
                            <h4 class="text-sm font-semibold text-gray-700 mb-3">Password Requirements:</h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                <div class="flex items-center text-sm" id="length-check">
                                    <div class="w-4 h-4 rounded-full border-2 border-gray-300 mr-3 flex-shrink-0 transition-all duration-200"></div>
                                    <span class="text-gray-600">At least 8 characters</span>
                                </div>
                                <div class="flex items-center text-sm" id="uppercase-check">
                                    <div class="w-4 h-4 rounded-full border-2 border-gray-300 mr-3 flex-shrink-0 transition-all duration-200"></div>
                                    <span class="text-gray-600">One uppercase letter</span>
                                </div>
                                <div class="flex items-center text-sm" id="lowercase-check">
                                    <div class="w-4 h-4 rounded-full border-2 border-gray-300 mr-3 flex-shrink-0 transition-all duration-200"></div>
                                    <span class="text-gray-600">One lowercase letter</span>
                                </div>
                                <div class="flex items-center text-sm" id="number-check">
                                    <div class="w-4 h-4 rounded-full border-2 border-gray-300 mr-3 flex-shrink-0 transition-all duration-200"></div>
                                    <span class="text-gray-600">One number</span>
                                </div>
                                <div class="flex items-center text-sm" id="special-check">
                                    <div class="w-4 h-4 rounded-full border-2 border-gray-300 mr-3 flex-shrink-0 transition-all duration-200"></div>
                                    <span class="text-gray-600">One special character</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Confirm Password -->
                    <div class="space-y-2">
                        <label for="confirm_password" class="block text-sm font-semibold text-gray-700">
                            Confirm New Password
                            <span class="text-red-500">*</span>
                        </label>
                        <div class="relative">
                            <input type="password" 
                                   id="confirm_password" 
                                   name="confirm_password" 
                                   required
                                   class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 bg-gray-50 hover:bg-white"
                                   placeholder="Confirm your new password"
                                   oninput="checkPasswordMatch()">
                            <div class="absolute inset-y-0 right-0 pr-3 flex items-center">
                                <button type="button" 
                                        class="text-gray-400 hover:text-gray-600 focus:outline-none"
                                        onclick="togglePasswordVisibility('confirm_password')">
                                    <i data-feather="eye" class="w-5 h-5"></i>
                                </button>
                            </div>
                        </div>
                        <div id="password-match-message" class="text-sm hidden"></div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="flex flex-col sm:flex-row gap-4 pt-6">
                        <button type="submit" 
                                id="submit-password-btn"
                                class="flex-1 bg-gradient-to-r from-blue-600 to-indigo-600 text-white px-6 py-3 rounded-xl hover:from-blue-700 hover:to-indigo-700 transition-all duration-200 font-semibold shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none">
                            <i data-feather="save" class="w-4 h-4 mr-2 inline"></i>
                            Update Password
                        </button>
                        <a href="{{ url_for('account_settings') }}" 
                           class="flex-1 bg-gray-100 text-gray-700 px-6 py-3 rounded-xl hover:bg-gray-200 transition-all duration-200 font-semibold text-center">
                            <i data-feather="arrow-left" class="w-4 h-4 mr-2 inline"></i>
                            Back to Settings
                        </a>
                    </div>
                </form>

                <!-- Security Tips -->
                <div class="mt-8 p-6 bg-yellow-50 border border-yellow-200 rounded-xl">
                    <h4 class="text-lg font-semibold text-yellow-800 mb-3 flex items-center">
                        <i data-feather="alert-triangle" class="w-5 h-5 mr-2"></i>
                        Security Tips
                    </h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-yellow-700">
                        <div>
                            <h5 class="font-semibold mb-2">Password Best Practices:</h5>
                            <ul class="space-y-1">
                                <li>• Use a unique password for each account</li>
                                <li>• Consider using a password manager</li>
                                <li>• Enable two-factor authentication if available</li>
                            </ul>
                        </div>
                        <div>
                            <h5 class="font-semibold mb-2">What to Avoid:</h5>
                            <ul class="space-y-1">
                                <li>• Never share your password with anyone</li>
                                <li>• Don't use personal information</li>
                                <li>• Avoid common words or patterns</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Password validation functions
function validatePasswordStrength(password) {
    const checks = {
        length: password.length >= 8,
        uppercase: /[A-Z]/.test(password),
        lowercase: /[a-z]/.test(password),
        number: /\d/.test(password),
        special: /[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(password)
    };
    
    // Calculate strength score
    const score = Object.values(checks).filter(Boolean).length;
    const strengthText = document.getElementById('strength-text');
    const strengthBar = document.getElementById('strength-bar');
    
    // Update strength indicator
    if (score <= 2) {
        strengthText.textContent = 'Weak';
        strengthText.className = 'text-sm font-medium text-red-500';
        strengthBar.className = 'bg-red-500 h-2 rounded-full transition-all duration-300';
        strengthBar.style.width = '25%';
    } else if (score <= 3) {
        strengthText.textContent = 'Fair';
        strengthText.className = 'text-sm font-medium text-yellow-500';
        strengthBar.className = 'bg-yellow-500 h-2 rounded-full transition-all duration-300';
        strengthBar.style.width = '50%';
    } else if (score <= 4) {
        strengthText.textContent = 'Good';
        strengthText.className = 'text-sm font-medium text-blue-500';
        strengthBar.className = 'bg-blue-500 h-2 rounded-full transition-all duration-300';
        strengthBar.style.width = '75%';
    } else {
        strengthText.textContent = 'Strong';
        strengthText.className = 'text-sm font-medium text-green-500';
        strengthBar.className = 'bg-green-500 h-2 rounded-full transition-all duration-300';
        strengthBar.style.width = '100%';
    }
    
    // Update requirement indicators
    Object.keys(checks).forEach(check => {
        const element = document.getElementById(`${check}-check`);
        if (element) {
            const indicator = element.querySelector('div');
            const text = element.querySelector('span');
            
            if (checks[check]) {
                indicator.className = 'w-4 h-4 rounded-full bg-green-500 border-2 border-green-500 mr-3 flex-shrink-0 flex items-center justify-center transition-all duration-200';
                indicator.innerHTML = '<svg class="w-3 h-3 text-white" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg>';
                text.className = 'text-green-600';
            } else {
                indicator.className = 'w-4 h-4 rounded-full border-2 border-gray-300 mr-3 flex-shrink-0 transition-all duration-200';
                indicator.innerHTML = '';
                text.className = 'text-gray-600';
            }
        }
    });
    
    return Object.values(checks).every(Boolean);
}

function checkPasswordMatch() {
    const newPassword = document.getElementById('new_password').value;
    const confirmPassword = document.getElementById('confirm_password').value;
    const messageElement = document.getElementById('password-match-message');
    const submitBtn = document.getElementById('submit-password-btn');
    
    if (confirmPassword === '') {
        messageElement.className = 'text-sm hidden';
        submitBtn.disabled = false;
        return;
    }
    
    if (newPassword === confirmPassword) {
        messageElement.textContent = '✓ Passwords match';
        messageElement.className = 'text-sm text-green-600 font-medium';
        messageElement.classList.remove('hidden');
        submitBtn.disabled = false;
    } else {
        messageElement.textContent = '✗ Passwords do not match';
        messageElement.className = 'text-sm text-red-600 font-medium';
        messageElement.classList.remove('hidden');
        submitBtn.disabled = true;
    }
}

function togglePasswordVisibility(fieldId) {
    const field = document.getElementById(fieldId);
    const button = field.parentElement.querySelector('button');
    const icon = button.querySelector('i');
    
    if (field.type === 'password') {
        field.type = 'text';
        icon.setAttribute('data-feather', 'eye-off');
    } else {
        field.type = 'password';
        icon.setAttribute('data-feather', 'eye');
    }
    
    // Reinitialize Feather icons
    if (typeof feather !== 'undefined') {
        feather.replace();
    }
}

// Form validation
function validatePasswordForm() {
    const currentPassword = document.getElementById('current_password').value;
    const newPassword = document.getElementById('new_password').value;
    const confirmPassword = document.getElementById('confirm_password').value;
    const submitBtn = document.getElementById('submit-password-btn');
    
    const isCurrentPasswordValid = currentPassword.length > 0;
    const isNewPasswordValid = validatePasswordStrength(newPassword);
    const isConfirmPasswordValid = newPassword === confirmPassword && confirmPassword.length > 0;
    
    submitBtn.disabled = !(isCurrentPasswordValid && isNewPasswordValid && isConfirmPasswordValid);
}

// Initialize form validation
document.addEventListener('DOMContentLoaded', function() {
    const newPasswordField = document.getElementById('new_password');
    const confirmPasswordField = document.getElementById('confirm_password');
    const currentPasswordField = document.getElementById('current_password');
    
    if (newPasswordField) {
        newPasswordField.addEventListener('input', function() {
            validatePasswordStrength(this.value);
            checkPasswordMatch();
            validatePasswordForm();
        });
        
        // Initial validation
        validatePasswordStrength(newPasswordField.value);
    }
    
    if (confirmPasswordField) {
        confirmPasswordField.addEventListener('input', function() {
            checkPasswordMatch();
            validatePasswordForm();
        });
    }
    
    if (currentPasswordField) {
        currentPasswordField.addEventListener('input', function() {
            validatePasswordForm();
        });
    }
    
    // Form submission validation
    const passwordForm = document.getElementById('password-change-form');
    if (passwordForm) {
        passwordForm.addEventListener('submit', function(e) {
            if (!validatePasswordForm()) {
                e.preventDefault();
                alert('Please ensure all password requirements are met and passwords match.');
            }
        });
    }
});
</script>
{% endblock %} 